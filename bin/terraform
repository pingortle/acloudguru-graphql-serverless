#!/bin/bash

DEFAULT_TERRAFORM_VERSION=0.11.1
DEFAULT_TERRAFORM_MODULE_PATH=deploy
DEFAULT_TERRAFORM_ENV_FILE=.terraform_env

TERRAFORM_VERSION=${TERRAFORM_VERSION:-$DEFAULT_TERRAFORM_VERSION}
TERRAFORM_MODULE_PATH=${TERRAFORM_MODULE_PATH:-$DEFAULT_TERRAFORM_MODULE_PATH}
TERRAFORM_ENV_FILE=${TERRAFORM_ENV_FILE:-$DEFAULT_TERRAFORM_ENV_FILE}

if test -f $TERRAFORM_ENV_FILE
then
  source $TERRAFORM_ENV_FILE
fi

docker run -it \
  -w /workspace/$TERRAFORM_MODULE_PATH \
  -v `pwd`:/workspace \
  -e AWS_ACCESS_KEY_ID \
  -e AWS_SECRET_ACCESS_KEY \
  -e AWS_DEFAULT_REGION=$AWS_REGION \
  hashicorp/terraform:$TERRAFORM_VERSION $@
